var q=Object.defineProperty;var $=(i,t,e)=>t in i?q(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>($(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const n of h.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(r){if(r.ep)return;r.ep=!0;const h=e(r);fetch(r.href,h)}})();var Q=1e-6,N=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function z(){var i=new N(16);return N!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function tt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function et(i,t,e){var s=t[0],r=t[1],h=t[2],n=t[3],o=t[4],d=t[5],u=t[6],c=t[7],A=t[8],w=t[9],x=t[10],b=t[11],y=t[12],R=t[13],F=t[14],p=t[15],g=e[0],E=e[1],m=e[2],T=e[3];return i[0]=g*s+E*o+m*A+T*y,i[1]=g*r+E*d+m*w+T*R,i[2]=g*h+E*u+m*x+T*F,i[3]=g*n+E*c+m*b+T*p,g=e[4],E=e[5],m=e[6],T=e[7],i[4]=g*s+E*o+m*A+T*y,i[5]=g*r+E*d+m*w+T*R,i[6]=g*h+E*u+m*x+T*F,i[7]=g*n+E*c+m*b+T*p,g=e[8],E=e[9],m=e[10],T=e[11],i[8]=g*s+E*o+m*A+T*y,i[9]=g*r+E*d+m*w+T*R,i[10]=g*h+E*u+m*x+T*F,i[11]=g*n+E*c+m*b+T*p,g=e[12],E=e[13],m=e[14],T=e[15],i[12]=g*s+E*o+m*A+T*y,i[13]=g*r+E*d+m*w+T*R,i[14]=g*h+E*u+m*x+T*F,i[15]=g*n+E*c+m*b+T*p,i}function it(i,t,e,s,r,h,n){var o=1/(t-e),d=1/(s-r),u=1/(h-n);return i[0]=-2*o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*u,i[11]=0,i[12]=(t+e)*o,i[13]=(r+s)*d,i[14]=(n+h)*u,i[15]=1,i}var rt=it;function st(i,t,e,s){var r,h,n,o,d,u,c,A,w,x,b=t[0],y=t[1],R=t[2],F=s[0],p=s[1],g=s[2],E=e[0],m=e[1],T=e[2];return Math.abs(b-E)<Q&&Math.abs(y-m)<Q&&Math.abs(R-T)<Q?tt(i):(c=b-E,A=y-m,w=R-T,x=1/Math.hypot(c,A,w),c*=x,A*=x,w*=x,r=p*w-g*A,h=g*c-F*w,n=F*A-p*c,x=Math.hypot(r,h,n),x?(x=1/x,r*=x,h*=x,n*=x):(r=0,h=0,n=0),o=A*n-w*h,d=w*r-c*n,u=c*h-A*r,x=Math.hypot(o,d,u),x?(x=1/x,o*=x,d*=x,u*=x):(o=0,d=0,u=0),i[0]=r,i[1]=o,i[2]=c,i[3]=0,i[4]=h,i[5]=d,i[6]=A,i[7]=0,i[8]=n,i[9]=u,i[10]=w,i[11]=0,i[12]=-(r*b+h*y+n*R),i[13]=-(o*b+d*y+u*R),i[14]=-(c*b+A*y+w*R),i[15]=1,i)}var at=et;function P(){var i=new N(2);return N!=Float32Array&&(i[0]=0,i[1]=0),i}function S(i,t){var e=new N(2);return e[0]=i,e[1]=t,e}function nt(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i}function ht(i,t){var e=t[0],s=t[1],r=e*e+s*s;return r>0&&(r=1/Math.sqrt(r)),i[0]=t[0]*r,i[1]=t[1]*r,i}function C(i,t,e,s){var r=t[0]-e[0],h=t[1]-e[1],n=Math.sin(s),o=Math.cos(s);return i[0]=r*o-h*n+e[0],i[1]=r*n+h*o+e[1],i}(function(){var i=P();return function(t,e,s,r,h,n){var o,d;for(e||(e=2),s||(s=0),r?d=Math.min(r*e+s,t.length):d=t.length,o=s;o<d;o+=e)i[0]=t[o],i[1]=t[o+1],h(i,i,n),t[o]=i[0],t[o+1]=i[1];return t}})();class B{constructor(t,e,s,r){this.x=t,this.y=e,this.width=s,this.height=r}copy(){return new B(this.x,this.y,this.width,this.height)}intersects(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}class ot{constructor(t,e,s){this.texture=t,this.drawRect=e,this.sourceRect=s}}class _{constructor(t,e,s){this.texture=t,this.width=e,this.height=s}static async loadTexture(t,e){return new Promise((r,h)=>{const n=new Image;n.src=e,n.onload=()=>{const o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),r(new _(o,n.width,n.height))},n.onerror=()=>{const o=`Failed to load image ${e}`;console.error(o),alert(o),h()}})}}class ct{constructor(t,e,s,r){this.a=t,this.b=e,this.c=s,this.d=r}}class lt{constructor(t,e,s,r){this.textureCoords=t,this.size=e,this.advance=s,this.offset=r}}class ut{constructor(t,e){a(this,"chars",{});this.texture=t,this.lineHeight=e}getChar(t){return this.chars[t]}createChar(t,e,s,r,h){this.chars[t]=new lt(e,s,r,h)}measureText(t,e=1){let s=0,r=this.lineHeight*e;for(const h of t){const n=h.charCodeAt(0),o=this.getChar(n);o&&(s+=o.advance*e)}return S(s,r)}}class dt{constructor(t,e){a(this,"audioBuffer",null);a(this,"volume",1e-5);this.audioContext=t,this.data=e,t.decodeAudioData(e).then(s=>this.audioBuffer=s)}play(){const t=this.audioContext.createGain();t.gain.value=this.volume,t.connect(this.audioContext.destination);const e=this.audioContext.createBufferSource();e.buffer=this.audioBuffer,e.connect(t),e.start()}}const At="/WebShooting/assets/sheet-35a0d1f8.png",ft="/WebShooting/assets/heart-558f2e45.png",gt="/WebShooting/assets/test_uv-c8ecf089.jpg",xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1QjNGRkZEQTg4RDAxMUUzQUVGMkIyOEUxRUZFMkQzMSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1QjNGRkZEQjg4RDAxMUUzQUVGMkIyOEUxRUZFMkQzMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjVCM0ZGRkQ4ODhEMDExRTNBRUYyQjI4RTFFRkUyRDMxIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjVCM0ZGRkQ5ODhEMDExRTNBRUYyQjI4RTFFRkUyRDMxIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+busJ6wAACLFJREFUeNrs3dtu1EYA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",Et="/WebShooting/assets/explosion-6fcbbd00.png",mt="/WebShooting/assets/sfx_laser1-910a0ad6.ogg",Tt="/WebShooting/assets/SpriteFont-6e9567bc.xml",Rt="/WebShooting/assets/SpriteFont-62aecb24.png",wt="/WebShooting/assets/ice01-19f39f97.jpg",vt="/WebShooting/assets/sheet-8e3f7486.xml";class f{static async initialize(t){this.spriteSheet=await _.loadTexture(t,At),this.heartTexture=await _.loadTexture(t,ft);const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.whitePixelTexture=new _(e,1,1),this.testUvTexture=await _.loadTexture(t,gt),this.backgroundTexture=await _.loadTexture(t,xt),this.explosionTexture=await _.loadTexture(t,Et),this.laserSound=await this.loadSound(mt),this.spriteFont=await this.loadSnowBSpriteFont(t,Tt,Rt),this.iceTexture=await _.loadTexture(t,wt),await this.loadSpriteSheet()}static async loadSpriteSheet(){const e=await(await fetch(vt)).text();new DOMParser().parseFromString(e,"text/xml").querySelectorAll("SubTexture").forEach(h=>{const n=h.getAttribute("name").replace(".png",""),o=parseInt(h.getAttribute("x")),d=parseInt(h.getAttribute("y")),u=parseInt(h.getAttribute("width")),c=parseInt(h.getAttribute("height")),A=new B(0,0,u,c),w=new B(o,d,u-1,c-1);this.sprites[n]=new ot(this.spriteSheet,A,w)})}static async loadSnowBSpriteFont(t,e,s){const r=await _.loadTexture(t,s),n=await(await fetch(e)).text(),d=new DOMParser().parseFromString(n,"text/xml"),u=parseInt(d.querySelector("common").getAttribute("lineHeight")),c=new ut(r,u);return d.querySelectorAll("char").forEach(A=>{const w=parseInt(A.getAttribute("id")),x=parseInt(A.getAttribute("x")),b=parseInt(A.getAttribute("y")),y=parseInt(A.getAttribute("width")),R=parseInt(A.getAttribute("height")),F=parseInt(A.getAttribute("xadvance")),p=parseInt(A.getAttribute("xoffset")),g=parseInt(A.getAttribute("yoffset")),E=x/r.width,m=1-b/r.height,T=(x+y)/r.width,O=1-(b+R)/r.height,G=new ct(S(E,m),S(T,m),S(T,O),S(E,O));c.createChar(w,G,S(y,R),F,S(p,g))}),c}static async loadSound(t){const s=await(await fetch(t)).arrayBuffer();return new dt(this.audioContext,s)}}a(f,"audioContext",new AudioContext),a(f,"laserSound"),a(f,"spriteSheet"),a(f,"sprites",{}),a(f,"testUvTexture"),a(f,"backgroundTexture"),a(f,"explosionTexture"),a(f,"spriteFont"),a(f,"iceTexture"),a(f,"heartTexture"),a(f,"whitePixelTexture");class D{static createArrayBuffer(t,e){const s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),s}static createIndexBuffer(t,e){const s=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),s}}class bt{constructor(t,e){a(this,"projection");a(this,"view");a(this,"projectionViewMatrix");this.width=t,this.height=e,this.projectionViewMatrix=z()}update(){this.projection=rt(z(),0,this.width,this.height,0,-1,1),this.view=st(z(),[0,0,1],[0,0,0],[0,1,0]),at(this.projectionViewMatrix,this.projection,this.view)}}class v{static createProgram(t,e,s){const r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,s),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)){const n=t.getProgramInfoLog(r);console.warn("Program linking failed: "+n)}return r}static createShader(t,e,s){const r=t.createShader(e);if(t.shaderSource(r,s),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const n=t.getShaderInfoLog(r);console.warn("Shader compilation failed: "+n)}return r}}const pt=`#version 300 es
precision mediump float;

layout(location = 0) in vec2 aPosition;
layout(location = 1) in vec2 aTexCoords;
layout(location = 2) in vec3 aColor;

out vec2 vTexCoords;
out vec3 vColor; 

uniform mat4 projectionViewMatrix;

void main()
{
    gl_Position =  projectionViewMatrix * vec4(aPosition, 0.0, 1.0);
    vTexCoords = aTexCoords;
    vColor = aColor;
}`,yt=`#version 300 es 
precision mediump float;

in vec2 vTexCoords;
in vec3 vColor;

uniform sampler2D uTexture;

layout(location = 0) out vec4 fragColor;
layout(location = 1) out vec4 brightness;

const float brightnessThreshold = 0.4;

void main()
{
    fragColor = texture(uTexture, vTexCoords) * vec4(vColor, 1.0);
    float br = dot(fragColor.rgb, vec3(0.299, 0.587, 0.114));

    if(br > brightnessThreshold)
    {
        brightness = fragColor;
    }
    else 
    {
        brightness = vec4(0.0, 0.0, 0.0, fragColor.a);
    }

}`;class L{constructor(t=1,e=1,s=1,r=1){this.r=t,this.g=e,this.b=s,this.a=r}}const I=1e3,Ft=7,X=4*Ft,M=6;class St{constructor(t,e,s){a(this,"instanceCount",0);a(this,"currentTexture",null);a(this,"defaultColor",new L);a(this,"projectionViewMatrixLocation");a(this,"camera");a(this,"vao");a(this,"buffer");a(this,"indexBuffer");a(this,"data",new Float32Array(X*I));a(this,"program");a(this,"v0",P());a(this,"v1",P());a(this,"v2",P());a(this,"v3",P());a(this,"_rotationOrigin",P());this.gl=t,this.width=e,this.height=s}setupIndexBuffer(){const t=new Uint16Array(I*M);for(let e=0;e<I;e++)t[e*M+0]=e*4+0,t[e*M+1]=e*4+1,t[e*M+2]=e*4+3,t[e*M+3]=e*4+1,t[e*M+4]=e*4+2,t[e*M+5]=e*4+3;this.indexBuffer=D.createIndexBuffer(this.gl,t)}async initialize(){this.camera=new bt(this.width,this.height);const t=v.createShader(this.gl,this.gl.VERTEX_SHADER,pt),e=v.createShader(this.gl,this.gl.FRAGMENT_SHADER,yt);this.program=v.createProgram(this.gl,t,e),this.projectionViewMatrixLocation=this.gl.getUniformLocation(this.program,"projectionViewMatrix"),this.gl.useProgram(this.program),this.vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.vao),this.buffer=D.createArrayBuffer(this.gl,this.data);const s=2*Float32Array.BYTES_PER_ELEMENT+2*Float32Array.BYTES_PER_ELEMENT+3*Float32Array.BYTES_PER_ELEMENT;this.gl.vertexAttribPointer(0,2,this.gl.FLOAT,!1,s,0),this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(1,2,this.gl.FLOAT,!1,s,2*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(2,3,this.gl.FLOAT,!1,s,4*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(2),this.setupIndexBuffer(),this.gl.bindVertexArray(null)}begin(){this.instanceCount=0,this.camera.update(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.useProgram(this.program),this.gl.uniformMatrix4fv(this.projectionViewMatrixLocation,!1,this.camera.projectionViewMatrix),this.gl.bindVertexArray(this.vao),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer)}drawSprite(t,e,s=this.defaultColor,r=0,h=null){this.currentTexture!=t&&(this.end(),this.gl.bindTexture(this.gl.TEXTURE_2D,t.texture),this.currentTexture=t);let n=this.instanceCount*X;this.v0[0]=e.x,this.v0[1]=e.y,this.v1[0]=e.x+e.width,this.v1[1]=e.y,this.v2[0]=e.x+e.width,this.v2[1]=e.y+e.height,this.v3[0]=e.x,this.v3[1]=e.y+e.height,r!=0&&(this._rotationOrigin[0]=e.x,this._rotationOrigin[1]=e.y,h!=null&&(this._rotationOrigin[0]+=e.width*h[0],this._rotationOrigin[1]+=e.width*h[1]),C(this.v0,this.v0,this._rotationOrigin,r),C(this.v1,this.v1,this._rotationOrigin,r),C(this.v2,this.v2,this._rotationOrigin,r),C(this.v3,this.v3,this._rotationOrigin,r)),this.data[0+n]=this.v0[0],this.data[1+n]=this.v0[1],this.data[2+n]=0,this.data[3+n]=1,this.data[4+n]=s.r,this.data[5+n]=s.g,this.data[6+n]=s.b,this.data[7+n]=this.v1[0],this.data[8+n]=this.v1[1],this.data[9+n]=1,this.data[10+n]=1,this.data[11+n]=s.r,this.data[12+n]=s.g,this.data[13+n]=s.b,this.data[14+n]=this.v2[0],this.data[15+n]=this.v2[1],this.data[16+n]=1,this.data[17+n]=0,this.data[18+n]=s.r,this.data[19+n]=s.g,this.data[20+n]=s.b,this.data[21+n]=this.v3[0],this.data[22+n]=this.v3[1],this.data[23+n]=0,this.data[24+n]=0,this.data[25+n]=s.r,this.data[26+n]=s.g,this.data[27+n]=s.b,this.instanceCount++,this.instanceCount>=I&&this.end()}drawSpriteSource(t,e,s,r=this.defaultColor,h=0,n=null){this.currentTexture!=t&&(this.end(),this.gl.bindTexture(this.gl.TEXTURE_2D,t.texture),this.currentTexture=t);let o=this.instanceCount*X;this.v0[0]=e.x,this.v0[1]=e.y,this.v1[0]=e.x+e.width,this.v1[1]=e.y,this.v2[0]=e.x+e.width,this.v2[1]=e.y+e.height,this.v3[0]=e.x,this.v3[1]=e.y+e.height,h!=0&&(this._rotationOrigin[0]=e.x,this._rotationOrigin[1]=e.y,n!=null&&(this._rotationOrigin[0]+=e.width*n[0],this._rotationOrigin[1]+=e.width*n[1]),C(this.v0,this.v0,this._rotationOrigin,h),C(this.v1,this.v1,this._rotationOrigin,h),C(this.v2,this.v2,this._rotationOrigin,h),C(this.v3,this.v3,this._rotationOrigin,h));let d=s.x/t.width,u=1-s.y/t.height,c=(s.x+s.width)/t.width,A=1-(s.y+s.height)/t.height;this.data[0+o]=this.v0[0],this.data[1+o]=this.v0[1],this.data[2+o]=d,this.data[3+o]=u,this.data[4+o]=r.r,this.data[5+o]=r.g,this.data[6+o]=r.b,this.data[7+o]=this.v1[0],this.data[8+o]=this.v1[1],this.data[9+o]=c,this.data[10+o]=u,this.data[11+o]=r.r,this.data[12+o]=r.g,this.data[13+o]=r.b,this.data[14+o]=this.v2[0],this.data[15+o]=this.v2[1],this.data[16+o]=c,this.data[17+o]=A,this.data[18+o]=r.r,this.data[19+o]=r.g,this.data[20+o]=r.b,this.data[21+o]=this.v3[0],this.data[22+o]=this.v3[1],this.data[23+o]=d,this.data[24+o]=A,this.data[25+o]=r.r,this.data[26+o]=r.g,this.data[27+o]=r.b,this.instanceCount++,this.instanceCount>=I&&this.end()}drawString(t,e,s,r=this.defaultColor,h=1){this.currentTexture!=t.texture.texture&&(this.end(),this.gl.bindTexture(this.gl.TEXTURE_2D,t.texture.texture),this.currentTexture=t.texture);let n=0;for(const o of e){const d=o.charCodeAt(0),u=t.getChar(d);let c=this.instanceCount*X;const A=s[0]+(n+u.offset[0])*h,w=s[1]+u.offset[1]*h,x=u.size[0]*h,b=u.size[1]*h;this.v0[0]=A,this.v0[1]=w,this.v1[0]=A+x,this.v1[1]=w,this.v2[0]=A+x,this.v2[1]=w+b,this.v3[0]=A,this.v3[1]=w+b;const y=u.textureCoords.a,R=u.textureCoords.b,F=u.textureCoords.c,p=u.textureCoords.d;this.data[0+c]=this.v0[0],this.data[1+c]=this.v0[1],this.data[2+c]=y[0],this.data[3+c]=y[1],this.data[4+c]=r.r,this.data[5+c]=r.g,this.data[6+c]=r.b,this.data[7+c]=this.v1[0],this.data[8+c]=this.v1[1],this.data[9+c]=R[0],this.data[10+c]=R[1],this.data[11+c]=r.r,this.data[12+c]=r.g,this.data[13+c]=r.b,this.data[14+c]=this.v2[0],this.data[15+c]=this.v2[1],this.data[16+c]=F[0],this.data[17+c]=F[1],this.data[18+c]=r.r,this.data[19+c]=r.g,this.data[20+c]=r.b,this.data[21+c]=this.v3[0],this.data[22+c]=this.v3[1],this.data[23+c]=p[0],this.data[24+c]=p[1],this.data[25+c]=r.r,this.data[26+c]=r.g,this.data[27+c]=r.b,this.instanceCount++,n+=u.advance,this.instanceCount>=I&&this.end()}}end(){this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.data),this.gl.drawElements(this.gl.TRIANGLES,6*this.instanceCount,this.gl.UNSIGNED_SHORT,0),this.instanceCount=0}}class Bt{constructor(){a(this,"keyDown",{});a(this,"_isMouseClicked",!1);a(this,"_mouseClickPosition",P())}initialize(){window.addEventListener("keydown",t=>this.keyDown[t.key]=!0),window.addEventListener("keyup",t=>this.keyDown[t.key]=!1),window.addEventListener("click",t=>{this._isMouseClicked=!0,this._mouseClickPosition[0]=t.clientX,this._mouseClickPosition[1]=t.clientY})}isKeyDown(t){return this.keyDown[t]}isKeyUp(t){return!this.keyDown[t]}get isMouseClicked(){return this._isMouseClicked}get mouseClickPosition(){return this._mouseClickPosition}resetMouseClicked(){this._isMouseClicked=!1}}class U{static createFramebuffer(t,e,s){const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);const h=t.createTexture();if(t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGB,e,s,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,h,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer incomplete");return{glFramebuffer:r,glTexture:h}}static createEmptyTexture(t,e,s){const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGB,e,s,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),r}static createFramebufferWith2ColorAttachments(t,e,s){const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);const h=this.createEmptyTexture(t,e,s),n=this.createEmptyTexture(t,e,s);if(t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,h,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT1,t.TEXTURE_2D,n,0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer incomplete");return{glFramebuffer:r,glTexture:h,glTexture1:n}}}const V=`#version 300 es
precision mediump float;

layout(location = 0) in vec2 a_position;
layout(location = 1) in vec2 a_texCoords;

out vec2 v_texCoords;

void main()
{
    gl_Position = vec4(a_position, 0.0, 1.0); 
    v_texCoords = a_texCoords;
}`,_t=`#version 300 es 
precision mediump float;

in vec2 v_texCoords;

// tex0
uniform sampler2D u_texture0;

// tex1 
uniform sampler2D u_texture1;

out vec4 fragColor;

void main() {
    vec4 t0 = texture(u_texture0, v_texCoords); // screen
    vec4 t1 = texture(u_texture1, v_texCoords); // bloom

    t0 *= (vec4(1.0) - clamp(t1, vec4(0.0), vec4(1.0)));

    fragColor = t0 + t1;
}`,W=`#version 300 es 
precision mediump float;

in vec2 v_texCoords;

uniform sampler2D u_texture;

out vec4 fragColor;

float weights[5] = float[](
    0.204163688, // main pixel, sampled once
    0.180173822, // left and right of main pixel
    0.123831536, 
    0.066282245, 
    0.027630550);

void main()
{
    // single pixel offset in x direction
    float horizontalTexel = 1.0f / vec2(textureSize(u_texture, 0)).x;

    vec4 result = texture(u_texture, v_texCoords) * weights[0];

    for(int i = 1; i < 5;i++)
    {
        float fi = float(i);
        vec2 offset = vec2(horizontalTexel* fi, 0.0f); // single pixel offset horizontal

        vec2 samleCoordsRight = v_texCoords + offset;
        vec2 samleCoordsLeft = v_texCoords - offset;

        result += texture(u_texture, samleCoordsRight) * weights[i];   
        result += texture(u_texture, samleCoordsLeft) * weights[i];     
    }

    fragColor = vec4(result.rgb, 1.0);
}`,j=`#version 300 es 
precision mediump float;

in vec2 v_texCoords;

uniform sampler2D u_texture;

out vec4 fragColor;

float weights[5] = float[](
    0.204163688, // main pixel, sampled once
    0.180173822, // left and right of main pixel
    0.123831536, 
    0.066282245, 
    0.027630550);

void main()
{
    // single pixel offset in y direction
    float verticalTexel = 1.0f / vec2(textureSize(u_texture, 0)).y;

    vec4 result = texture(u_texture, v_texCoords) * weights[0];

    for(int i = 1; i < 5;i++)
    {
        float fi = float(i);
        vec2 offset = vec2( 0.0f, verticalTexel* fi); // single pixel offset vertical

        vec2 samleCoordsUp = v_texCoords + offset;
        vec2 samleCoordsDown = v_texCoords - offset;

        result += texture(u_texture, samleCoordsUp) * weights[i];   
        result += texture(u_texture, samleCoordsDown) * weights[i];     
    }

    fragColor = vec4(result.rgb, 1.0);
}`;class Pt{constructor(t,e,s){a(this,"glHorizontalPassProgram");a(this,"glVerticalPassProgram");a(this,"glFramebuffer0");a(this,"glFramebuffer1");a(this,"glPingPongTexture");a(this,"vao");a(this,"buffer");this.gl=t,this.width=e,this.height=s;const r=v.createShader(t,t.VERTEX_SHADER,V),h=v.createShader(t,t.FRAGMENT_SHADER,W);this.glHorizontalPassProgram=v.createProgram(t,r,h);const n=v.createShader(t,t.FRAGMENT_SHADER,j);this.glVerticalPassProgram=v.createProgram(t,r,n);const o=U.createFramebuffer(t,e,s);this.glFramebuffer0=o.glFramebuffer,this.glPingPongTexture=o.glTexture;const d=U.createFramebuffer(t,e,s);this.glFramebuffer1=d.glFramebuffer,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.buffer=D.createArrayBuffer(t,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0,-1,-1,0,0]));const u=Float32Array.BYTES_PER_ELEMENT*4;this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,2,t.FLOAT,!1,u,0),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(1,2,t.FLOAT,!1,u,Float32Array.BYTES_PER_ELEMENT*2),this.gl.bindVertexArray(null),this.gl.bindBuffer(t.ARRAY_BUFFER,null)}draw(t){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFramebuffer1),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.glPingPongTexture,0),this.gl.useProgram(this.glHorizontalPassProgram),this.gl.bindVertexArray(this.vao),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFramebuffer0),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t,0),this.gl.useProgram(this.glVerticalPassProgram),this.gl.bindVertexArray(this.vao),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glPingPongTexture),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.bindVertexArray(null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.useProgram(null)}}class Ct{constructor(t,e,s){a(this,"glProgram");a(this,"blurEffect");a(this,"glFramebuffer");a(this,"glScenePassTextureLocation");a(this,"glScenePassTexture");a(this,"glBrightnessBlurTextureLocation");a(this,"glBrightnessBlurTexture");a(this,"vao");a(this,"buffer");this.gl=t,this.width=e,this.height=s;const r=v.createShader(t,t.VERTEX_SHADER,V),h=v.createShader(t,t.FRAGMENT_SHADER,_t);this.glProgram=v.createProgram(t,r,h);const n=U.createFramebufferWith2ColorAttachments(t,e,s);this.glFramebuffer=n.glFramebuffer,this.glScenePassTexture=n.glTexture,this.glBrightnessBlurTexture=n.glTexture1,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.buffer=D.createArrayBuffer(t,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0,-1,-1,0,0]));const o=Float32Array.BYTES_PER_ELEMENT*4;this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,2,t.FLOAT,!1,o,0),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(1,2,t.FLOAT,!1,o,Float32Array.BYTES_PER_ELEMENT*2),this.gl.bindVertexArray(null),this.gl.bindBuffer(t.ARRAY_BUFFER,null),this.glScenePassTextureLocation=t.getUniformLocation(this.glProgram,"u_texture0"),this.glBrightnessBlurTextureLocation=t.getUniformLocation(this.glProgram,"u_texture1"),this.blurEffect=new Pt(t,e,s)}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFramebuffer),this.gl.drawBuffers([this.gl.COLOR_ATTACHMENT0,this.gl.COLOR_ATTACHMENT1])}draw(){this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.blurEffect.draw(this.glBrightnessBlurTexture),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.useProgram(this.glProgram),this.gl.uniform1i(this.glScenePassTextureLocation,0),this.gl.uniform1i(this.glBrightnessBlurTextureLocation,1),this.gl.bindVertexArray(this.vao),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glScenePassTexture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glBrightnessBlurTexture),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.bindVertexArray(null),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.useProgram(null)}}class Mt{constructor(t,e,s){a(this,"glHorizontalPassProgram");a(this,"glHorizontalFramebuffer");a(this,"glHorizontalTexture");a(this,"glVerticalPassProgram");a(this,"glVerticalFramebuffer");a(this,"glVerticalTexture");a(this,"doHorizontalPass",!0);a(this,"doVerticalPass",!0);a(this,"vao");a(this,"buffer");this.gl=t,this.width=e,this.height=s;const r=v.createShader(t,t.VERTEX_SHADER,V),h=v.createShader(t,t.FRAGMENT_SHADER,W);this.glHorizontalPassProgram=v.createProgram(t,r,h);const n=v.createShader(t,t.FRAGMENT_SHADER,j);this.glVerticalPassProgram=v.createProgram(t,r,n);const o=U.createFramebuffer(t,e,s);this.glHorizontalFramebuffer=o.glFramebuffer,this.glHorizontalTexture=o.glTexture;const d=U.createFramebuffer(t,e,s);this.glVerticalFramebuffer=d.glFramebuffer,this.glVerticalTexture=d.glTexture,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.buffer=D.createArrayBuffer(t,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0,-1,-1,0,0]));const u=Float32Array.BYTES_PER_ELEMENT*4;this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,2,t.FLOAT,!1,u,0),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(1,2,t.FLOAT,!1,u,Float32Array.BYTES_PER_ELEMENT*2),this.gl.bindVertexArray(null),this.gl.bindBuffer(t.ARRAY_BUFFER,null)}bind(){this.doHorizontalPass?this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glHorizontalFramebuffer):this.doVerticalPass&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glVerticalFramebuffer)}draw(){this.doHorizontalPass&&(this.doVerticalPass?this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glVerticalFramebuffer):this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.useProgram(this.glHorizontalPassProgram),this.gl.bindVertexArray(this.vao),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glHorizontalTexture),this.gl.drawArrays(this.gl.TRIANGLES,0,6)),this.doVerticalPass&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.useProgram(this.glVerticalPassProgram),this.gl.bindVertexArray(this.vao),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glVerticalTexture),this.gl.drawArrays(this.gl.TRIANGLES,0,6)),this.gl.bindVertexArray(null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.useProgram(null)}}const Dt=`#version 300 es 
precision mediump float;

in vec2 v_texCoords;

uniform sampler2D u_texture;

out vec4 fragColor;

void main()
{
    vec3 texColor = texture(u_texture, v_texCoords).rgb;
    vec3 grayscaleWeights = vec3(0.299, 0.587, 0.114);

    // texColor.r * 0.299 + texColor.g * 0.587 + texColor.b * 0.114
    float l = dot(texColor, grayscaleWeights);
    fragColor = vec4(vec3(l), 1.0);
}`;class Ut{constructor(t,e,s){a(this,"glProgram");a(this,"glFramebuffer");a(this,"glTexture");a(this,"vao");a(this,"buffer");this.gl=t,this.width=e,this.height=s;const r=v.createShader(t,t.VERTEX_SHADER,V),h=v.createShader(t,t.FRAGMENT_SHADER,Dt);this.glProgram=v.createProgram(t,r,h);const n=U.createFramebuffer(t,e,s);this.glFramebuffer=n.glFramebuffer,this.glTexture=n.glTexture,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.buffer=D.createArrayBuffer(t,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0,-1,-1,0,0]));const o=Float32Array.BYTES_PER_ELEMENT*4;this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,2,t.FLOAT,!1,o,0),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(1,2,t.FLOAT,!1,o,Float32Array.BYTES_PER_ELEMENT*2),this.gl.bindVertexArray(null),this.gl.bindBuffer(t.ARRAY_BUFFER,null)}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFramebuffer),this.gl.clearColor(1,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}draw(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.useProgram(this.glProgram),this.gl.bindVertexArray(this.vao),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glTexture),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.bindVertexArray(null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.useProgram(null)}}const It=`#version 300 es 
precision mediump float;

in vec2 v_texCoords;

// tex0
uniform sampler2D u_texture0;

// tex1 
uniform sampler2D u_texture1;

uniform float u_mixValue;

out vec4 fragColor;

void main()
{
    vec3 t0 = texture(u_texture0, v_texCoords).rgb; // screen
    vec3 t1 = texture(u_texture1, v_texCoords).rgb; // other

    fragColor = vec4(mix(t0, t1, u_mixValue), 1.0);
}`;class Lt{constructor(t,e,s){a(this,"glProgram");a(this,"glFramebuffer");a(this,"glTexture");a(this,"vao");a(this,"buffer");a(this,"combineTexture");a(this,"mixValue",.25);a(this,"textureUnit0Location");a(this,"textureUnit1Location");a(this,"mixValueLocation");this.gl=t,this.width=e,this.height=s;const r=v.createShader(t,t.VERTEX_SHADER,V),h=v.createShader(t,t.FRAGMENT_SHADER,It);this.glProgram=v.createProgram(t,r,h);const n=U.createFramebuffer(t,e,s);this.glFramebuffer=n.glFramebuffer,this.glTexture=n.glTexture,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.buffer=D.createArrayBuffer(t,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0,-1,-1,0,0]));const o=Float32Array.BYTES_PER_ELEMENT*4;this.gl.enableVertexAttribArray(0),this.gl.vertexAttribPointer(0,2,t.FLOAT,!1,o,0),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(1,2,t.FLOAT,!1,o,Float32Array.BYTES_PER_ELEMENT*2),this.gl.bindVertexArray(null),this.gl.bindBuffer(t.ARRAY_BUFFER,null),this.textureUnit0Location=t.getUniformLocation(this.glProgram,"u_texture0"),this.textureUnit1Location=t.getUniformLocation(this.glProgram,"u_texture1"),this.mixValueLocation=t.getUniformLocation(this.glProgram,"u_mixValue")}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFramebuffer),this.gl.clearColor(1,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}setTexture(t){this.combineTexture=t}draw(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.useProgram(this.glProgram),this.gl.bindVertexArray(this.vao),this.gl.uniform1i(this.textureUnit0Location,0),this.gl.uniform1i(this.textureUnit1Location,1),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.glTexture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.combineTexture.texture),this.gl.uniform1f(this.mixValueLocation,this.mixValue),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindVertexArray(null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.useProgram(null)}}class Nt{constructor(t,e,s){this.gl=t,this.width=e,this.height=s}createGrayScaleEffect(){return new Ut(this.gl,this.width,this.height)}createTextureEffect(){return new Lt(this.gl,this.width,this.height)}createBlurEffect(){return new Mt(this.gl,this.width,this.height)}createBloomEffect(){return new Ct(this.gl,this.width,this.height)}}class Vt{constructor(){a(this,"canvas");a(this,"_gl");a(this,"lastTime",0);a(this,"spriteRenderer");a(this,"inputManager",new Bt);a(this,"effectsFactory");a(this,"clientBounds",P());a(this,"onUpdate",t=>{});a(this,"onDraw",()=>{});a(this,"rotation",0)}async initialize(){this.canvas=document.getElementById("canvas"),this.inputManager.initialize(),this._gl=this.canvas.getContext("webgl2",{alpha:!1}),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!0),this.clientBounds[0]=this.canvas.width,this.clientBounds[1]=this.canvas.height,await f.initialize(this._gl),this.spriteRenderer=new St(this._gl,this.canvas.width,this.canvas.height),await this.spriteRenderer.initialize(),this.effectsFactory=new Nt(this._gl,this.canvas.width,this.canvas.height)}draw(){const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.onUpdate(e),this._gl.viewport(0,0,this.canvas.width,this.canvas.height),this._gl.clearColor(0,0,0,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT),this.onDraw(),window.requestAnimationFrame(()=>this.draw())}}const Ot=.25;class Xt{constructor(t,e){a(this,"drawRect");a(this,"drawRect2");this.width=t,this.height=e,this.drawRect=new B(0,0,t,e),this.drawRect2=new B(0,0,t,e)}update(t){if(this.drawRect.y+=Ot*t,this.drawRect2.y=this.drawRect.y-this.height,this.drawRect.y>this.height||this.drawRect2.y>this.height){const e=this.drawRect;this.drawRect=this.drawRect2,this.drawRect2=e}}draw(t){t.drawSprite(f.backgroundTexture,this.drawRect),t.drawSprite(f.backgroundTexture,this.drawRect2)}}const Gt=.75;class Qt{constructor(){a(this,"drawRect");a(this,"sourceRect");a(this,"texture");a(this,"active",!0);const t=f.sprites.laserBlue01;this.texture=t.texture,this.drawRect=t.drawRect.copy(),this.sourceRect=t.sourceRect.copy()}spawn(t){this.active=!0,this.drawRect.x=t.drawRect.x+t.drawRect.width/2-this.drawRect.width/2,this.drawRect.y=t.drawRect.y-this.drawRect.height}update(t){this.drawRect.y-=Gt*t,this.drawRect.y+this.drawRect.height<0&&(this.active=!1)}draw(t){t.drawSpriteSource(this.texture,this.drawRect,this.sourceRect)}}const zt=250;class kt{constructor(t){a(this,"bullets",[]);a(this,"time",0);this.player=t}intersectsEnemy(t){for(let e of this.bullets)if(e.active&&e.drawRect.intersects(t.drawRect))return e.active=!1,!0;return!1}create(){let t=this.bullets.find(e=>!e.active);t||(t=new Qt,this.bullets.push(t)),t.spawn(this.player),f.laserSound.play()}update(t){this.time+=t,this.time>zt&&(this.time=0,this.create());for(let e of this.bullets)e.active&&e.update(t)}draw(t){for(let e of this.bullets)e.active&&e.draw(t)}}const H=["meteorBrown_big1","meteorBrown_big2","meteorBrown_big3","meteorBrown_big4","meteorBrown_med1","meteorBrown_med3","meteorGrey_big1","meteorGrey_big2","meteorGrey_big3","meteorGrey_big4","meteorGrey_med1","meteorGrey_med2"],Y=.05,Ht=.25;class Yt{constructor(t,e){a(this,"active",!0);a(this,"drawRect");a(this,"texture");a(this,"sourceRect");a(this,"rotationOrigin",S(.5,.5));a(this,"rotation",0);a(this,"rotationSpeed",0);a(this,"speed");this.gameWidth=t,this.gameHeight=e;const s=H[Math.floor(Math.random()*H.length)];this.drawRect=f.sprites[s].drawRect.copy(),this.sourceRect=f.sprites[s].sourceRect.copy(),this.texture=f.sprites[s].texture,this.speed=Math.random()*(Ht-Y)+Y,this.rotationSpeed=(Math.random()-.5)*.005}update(t){this.drawRect.y+=this.speed*t,this.rotation+=this.rotationSpeed*t}draw(t){t.drawSpriteSource(this.texture,this.drawRect,this.sourceRect,void 0,this.rotation,this.rotationOrigin)}}const Wt=1e3;class jt{constructor(t,e,s,r,h,n){a(this,"timeToSpawn",0);a(this,"pool",[]);this.width=t,this.height=e,this.player=s,this.explosionManager=r,this.bulletManager=h,this.score=n}spawnEnemy(){if(this.timeToSpawn>Wt){this.timeToSpawn=0;let t=this.pool.find(e=>!e.active);t||(t=new Yt(this.width,this.height),this.pool.push(t)),t.active=!0,t.drawRect.x=Math.random()*(this.width-t.drawRect.width),t.drawRect.y=-t.drawRect.height}}update(t){this.timeToSpawn+=t,this.spawnEnemy();for(let e of this.pool)e.active&&(e.update(t),this.bulletManager.intersectsEnemy(e)&&(e.active=!1,this.explosionManager.create(e.drawRect),this.score.currentScore+=10),e.drawRect.intersects(this.player.drawRect)&&(e.active=!1,this.explosionManager.create(e.drawRect),this.player.takeDamage(25)),e.drawRect.y>this.height&&(e.active=!1))}draw(t){for(let e of this.pool)e.active&&e.draw(t)}}const Zt=1e3/30;class Kt{constructor(){a(this,"playing",!1);a(this,"time",0);a(this,"sourceRect");a(this,"drawRect");a(this,"currentCol",0);a(this,"currentRow",0);a(this,"cols",4);a(this,"rows",4);this.sourceRect=new B(0,0,32,32),this.drawRect=new B(0,0,32,32)}play(t){this.playing=!0,this.time=0,this.currentCol=0,this.currentRow=0,this.drawRect=t.copy()}update(t){this.playing&&(this.time+=t,this.time>Zt&&(this.time=0,this.currentCol++,this.currentCol>=this.cols&&(this.currentCol=0,this.currentRow++),this.currentRow>=this.rows&&(this.currentRow=0,this.playing=!1)))}draw(t){this.sourceRect.x=this.currentCol*this.sourceRect.width,this.sourceRect.y=this.currentRow*this.sourceRect.height,t.drawSpriteSource(f.explosionTexture,this.drawRect,this.sourceRect)}}class Jt{constructor(){a(this,"explosions",[])}create(t){let e=this.explosions.find(s=>!s.playing);e||(e=new Kt,this.explosions.push(e)),e.play(t)}update(t){for(let e of this.explosions)e.playing&&e.update(t)}draw(t){for(let e of this.explosions)e.playing&&e.draw(t)}}const qt=.25,$t=1e3;class te{constructor(t,e,s){a(this,"movementDirection",P());a(this,"drawRect");a(this,"sourceRect");a(this,"texture");a(this,"health",100);a(this,"isInvincible",!1);a(this,"invincibilityTimer",0);a(this,"showPlayer",!0);a(this,"blinkTimer",0);a(this,"BLINK_INTERVAL",100);this.inputManager=t,this.width=e,this.height=s;const r=f.sprites.playerShip1_blue;this.texture=r.texture,this.drawRect=r.drawRect.copy(),this.sourceRect=r.sourceRect.copy(),this.drawRect.x=this.width/2-this.drawRect.width/2,this.drawRect.y=this.height-this.drawRect.height-20}takeDamage(t){this.isInvincible||(this.health-=t,this.health<0&&(this.health=0),this.isInvincible=!0,this.invincibilityTimer=$t,this.showPlayer=!0,this.blinkTimer=0)}isDead(){return this.health<=0}update(t){this.isDead()||(this.isInvincible&&(this.invincibilityTimer-=t,this.blinkTimer+=t,this.blinkTimer>this.BLINK_INTERVAL&&(this.showPlayer=!this.showPlayer,this.blinkTimer=0),this.invincibilityTimer<=0&&(this.isInvincible=!1,this.showPlayer=!0)),this.movementDirection[0]=0,this.movementDirection[1]=0,this.inputManager.isKeyDown("ArrowUp")&&(this.movementDirection[1]=-1),this.inputManager.isKeyDown("ArrowDown")&&(this.movementDirection[1]=1),this.inputManager.isKeyDown("ArrowLeft")&&(this.movementDirection[0]=-1),this.inputManager.isKeyDown("ArrowRight")&&(this.movementDirection[0]=1),ht(this.movementDirection,this.movementDirection),nt(this.movementDirection,this.movementDirection,qt*t),this.drawRect.x+=this.movementDirection[0],this.drawRect.y+=this.movementDirection[1],this.drawRect.x<0?this.drawRect.x=0:this.drawRect.x>this.width-this.drawRect.width&&(this.drawRect.x=this.width-this.drawRect.width),this.drawRect.y<0?this.drawRect.y=0:this.drawRect.y>this.height-this.drawRect.height&&(this.drawRect.y=this.height-this.drawRect.height))}draw(t){this.showPlayer&&t.drawSpriteSource(this.texture,this.drawRect,this.sourceRect)}}class ee{constructor(){a(this,"currentScore",0);a(this,"scorePosition",S(10,10));a(this,"heartIconSize",30);a(this,"heartIconSpacing",5);a(this,"heartIconStartPosition",S(445,855))}draw(t,e){t.drawString(f.spriteFont,"Score: "+this.currentScore,this.scorePosition,void 0,.5);const s=4,r=Math.floor(e.health/(100/s));for(let h=0;h<s;h++){const n=new B(this.heartIconStartPosition[0]+h*(this.heartIconSize+this.heartIconSpacing),this.heartIconStartPosition[1],this.heartIconSize,this.heartIconSize);h<r?t.drawSprite(f.heartTexture,n):t.drawSprite(f.heartTexture,n,new L(.5,.5,.5))}}}class ie{constructor(t,e,s,r,h,n,o,d,u=1){a(this,"rect");a(this,"text");a(this,"font");a(this,"textColor");a(this,"bgColor");a(this,"scale");this.text=t,this.rect=new B(e,s,r,h),this.font=n,this.textColor=o,this.bgColor=d,this.scale=u}draw(t){const s=new L(1,1,1),r=new B(this.rect.x-2,this.rect.y-2,this.rect.width+2*2,this.rect.height+2*2),h=new B(0,0,1,1);t.drawSpriteSource(f.whitePixelTexture,r,h,s),t.drawSpriteSource(f.whitePixelTexture,this.rect,h,this.bgColor);const n=this.font.measureText(this.text,this.scale),o=S(this.rect.x+this.rect.width/2-n[0]/2,this.rect.y+this.rect.height/2-n[1]/2);t.drawString(this.font,this.text,o,this.textColor,this.scale)}isClicked(t,e){return t>=this.rect.x&&t<=this.rect.x+this.rect.width&&e>=this.rect.y&&e<=this.rect.y+this.rect.height}}const l=new Vt;l.initialize().then(()=>{let i=0,t,e,s,r,h,n;const o=l.effectsFactory.createBloomEffect(),d=200,u=65,c=.7,A="RETRY",w=new L(1,1,1),x=new L(.2,.5,.8);let b;const y=()=>{t=new te(l.inputManager,l.clientBounds[0],l.clientBounds[1]),e=new Xt(l.clientBounds[0],l.clientBounds[1]),s=new Jt,r=new kt(t),h=new ee,n=new jt(l.clientBounds[0],l.clientBounds[1],t,s,r,h),i=1};l.onUpdate=R=>{if(i===0)l.inputManager.isMouseClicked&&(y(),l.inputManager.resetMouseClicked());else if(i===1)e.update(R),t.update(R),n.update(R),s.update(R),r.update(R),t.isDead()&&(i=2);else if(i===2&&(e.update(R),l.inputManager.isMouseClicked)){const F=l.inputManager.mouseClickPosition[0],p=l.inputManager.mouseClickPosition[1],g=l.canvas.getBoundingClientRect(),E=F-g.left,m=p-g.top;b.isClicked(E,m)&&y(),l.inputManager.resetMouseClicked()}},l.onDraw=()=>{if(o.bind(),l.spriteRenderer.begin(),i===0){const R="CLICK TO START",p=f.spriteFont.measureText(R,1),g=S(l.clientBounds[0]/2-p[0]/2,l.clientBounds[1]/2-p[1]/2);l.spriteRenderer.drawString(f.spriteFont,R,g,void 0,1)}else if(i===1)e.draw(l.spriteRenderer),t.draw(l.spriteRenderer),n.draw(l.spriteRenderer),r.draw(l.spriteRenderer),s.draw(l.spriteRenderer),h.draw(l.spriteRenderer,t);else if(i===2){const R=new L(0,0,0,.6);l.spriteRenderer.drawSprite(f.whitePixelTexture,new B(0,0,l.clientBounds[0],l.clientBounds[1]),R),e.draw(l.spriteRenderer),h.draw(l.spriteRenderer,t);const F="GAME OVER",p=`Final Score: ${h.currentScore}`,g=1,E=.75,m=f.spriteFont.measureText(F,g),T=f.spriteFont.measureText(p,E),O=-50,G=20,Z=S(l.clientBounds[0]/2-m[0]/2,l.clientBounds[1]/2-m[1]/2+O),k=S(l.clientBounds[0]/2-T[0]/2,l.clientBounds[1]/2-T[1]/2+G);l.spriteRenderer.drawString(f.spriteFont,F,Z,void 0,g),l.spriteRenderer.drawString(f.spriteFont,p,k,void 0,E);const K=l.clientBounds[0]/2-d/2,J=k[1]+T[1]+30;b=new ie(A,K,J,d,u,f.spriteFont,w,x,c),b.draw(l.spriteRenderer)}l.spriteRenderer.end(),o.draw()},l.draw()});
